<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Visualynx — AI Kit Builder by Visual Sports</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <style>
        :root { --accent: #FFE135; --dark-bg: #0a0a0a; }
        body { background: var(--dark-bg); color: white; font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Panel Lateral */
        .sidebar { 
            width: 320px; background: rgba(20, 20, 20, 0.95); padding: 30px; 
            border-right: 1px solid #333; display: flex; flex-direction: column; gap: 25px; 
            z-index: 100; backdrop-filter: blur(10px);
        }
        
        /* Área de Visualización con el GIF de fondo */
        .preview-area { 
            flex-grow: 1; display: flex; justify-content: center; align-items: center; 
            background: url('assets/FONDO.gif') no-repeat center center;
            background-size: cover; position: relative;
        }

        /* Mockup Dinámico (El sándwich de tus capas de Photoshop) */
        .mockup-container {
            position: relative; width: 600px; height: 750px; margin: auto;
        }
        .layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; object-fit: contain; }

        /* Capa de diseño recortada por la silueta */
        #dynamic-color {
            mask-image: url('assets/Frente.png'); -webkit-mask-image: url('assets/Frente.png');
            mask-size: contain; -webkit-mask-size: contain;
            mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat;
            background: #00ccff; z-index: 1;
        }

        .control-box { background: #1e1e1e; padding: 15px; border-radius: 10px; border: 1px solid #333; }
        h1 { font-size: 1.4rem; color: var(--accent); margin: 0; letter-spacing: -1px; }
        h2 { font-size: 0.8rem; color: #888; text-transform: uppercase; margin-bottom: 10px; }
        
        input[type="color"] { width: 100%; height: 45px; border: none; cursor: pointer; background: none; }
        button { 
            background: var(--accent); color: black; border: none; padding: 15px; 
            border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%;
            text-transform: uppercase; transition: 0.2s;
        }
        button:hover { transform: scale(1.02); background: #fff; }

        /* Ocultamos el canvas técnico de 65x80cm de la vista del cliente */
        #canvas-hidden { position: absolute; left: -9999px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div>
            <h1>Visualynx</h1>
            <p style="font-size: 0.7rem; color: #666; margin-top: 5px;">AI Kit Builder by Visual Sports</p>
        </div>

        <div class="control-box">
            <h2>Color Principal</h2>
            <input type="color" id="kitColor" value="#00ccff" onchange="updateSystem(this.value)">
        </div>

        <div class="control-box">
            <h2>Añadir Logos</h2>
            <input type="file" id="logoUpload" accept="image/*" style="font-size: 0.8rem;">
        </div>

        <button onclick="generateProductionFile()" style="margin-top: auto; background: #28a745; color: white;">Finalizar Diseño</button>
    </div>

    <div class="preview-area">
        <div class="mockup-container">
            <!-- 1. Color dinámico -->
            <div id="dynamic-color" class="layer"></div>
            <!-- 2. Capa de Sombras (Multiplicar) -->
            <img src="assets/Frente_Sombras.png" class="layer" style="mix-blend-mode: multiply; opacity: 0.9; z-index: 2;">
            <!-- 3. Capa de Brillos (Trama) -->
            <img src="assets/Frente_Highlights_2.png" class="layer" style="mix-blend-mode: screen; opacity: 0.6; z-index: 3;">
        </div>
    </div>

    <div id="canvas-hidden">
        <canvas id="flatCanvas"></canvas>
    </div>

    <script>
        // Canvas técnico de 65x80cm (escala 10px = 1cm)
        const canvas = new fabric.Canvas('flatCanvas', {
            width: 650,
            height: 800,
            backgroundColor: '#00ccff'
        });

        function updateSystem(color) {
            // Actualiza el 3D visual que ve el cliente
            document.getElementById('dynamic-color').style.backgroundColor = color;
            // Actualiza el plano técnico de 65x80cm para ti
            canvas.setBackgroundColor(color, canvas.renderAll.bind(canvas));
        }

        // Lógica para logos...
        document.getElementById('logoUpload').onchange = function(e) {
            const reader = new FileReader();
            reader.onload = function(f) {
                fabric.Image.fromURL(f.target.result, function(img) {
                    img.scaleToWidth(150);
                    canvas.add(img);
                    canvas.centerObject(img);
                });
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        function generateProductionFile() {
            const dataURL = canvas.toDataURL({ format: 'png', multiplier: 4 });
            const link = document.createElement('a');
            link.download = 'Visualynx_Frente_65x80.png';
            link.href = dataURL;
            link.click();
            alert("Arte plano generado a 300dpi. ¡Listo para tu montaje!");
        }
    </script>
</body>
</html>
